<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Summary</title>
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Accountability Tracker">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="theme-color" content="#333">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            text-align: center;
            color: #333;
            font-size: 2.2rem;
            margin: 20px 0 30px 0;
            padding: 10px;
            border-bottom: 2px solid #333;
        }
        .summary-sections {
            display: flex;
            gap: 20px;
            justify-content: center;
            align-items: flex-start;
            flex-wrap: wrap;
        }
        .summary-section {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 20px 0;
            width: 50%;
            max-width: 600px;
            min-width: 320px;
            box-sizing: border-box;
        }
        .summary-section-tuning {
            width: 300px;
            min-width: 220px;
            max-width: 340px;
            padding: 16px 16px 12px 16px;
            margin-top: 40px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f0f0f0;
            font-size: 0.95em;
            word-break: break-word;
            white-space: normal;
        }
        .gym-header-small {
            font-size: 0.85em;
            line-height: 1.1;
            word-break: break-word;
            white-space: normal;
        }
        .editable {
            cursor: pointer;
            position: relative;
        }
        .editable:hover {
            background-color: #f8f8f8;
        }
        .editable input {
            width: 100%;
            padding: 4px;
            border: 1px solid #007bff;
            border-radius: 3px;
            text-align: center;
        }
        .editable input:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25);
        }
        .nav-link {
            display: block;
            text-align: center;
            margin: 30px auto 0 auto;
            color: #007bff;
            text-decoration: none;
            font-size: 1.1rem;
        }
        .nav-link:hover {
            text-decoration: underline;
        }
        @media (max-width: 1100px) {
            .summary-sections {
                flex-direction: column;
                align-items: center;
            }
            .summary-section, .summary-section-tuning {
                width: 95%;
                max-width: 700px;
            }
        }
        @media (max-width: 600px) {
            th, td {
                padding: 4px;
                font-size: 0.85em;
            }
            .summary-section {
                padding: 10px;
            }
            .gym-header-small {
                font-size: 0.75em;
            }
        }
        /* Progress Dashboard Styles */
        .progress-dashboard {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin: 20px auto;
            max-width: 800px;
        }
        .progress-metric {
            margin-bottom: 15px;
        }
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .progress-bar-container {
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, #007bff, #00c6ff);
            transition: width 0.3s ease;
        }
        .progress-target {
            cursor: pointer;
            padding: 2px 5px;
            border-radius: 3px;
        }
        .progress-target:hover {
            background-color: #f0f0f0;
        }
        .progress-target input {
            width: 50px;
            padding: 2px;
            border: 1px solid #007bff;
            border-radius: 3px;
            text-align: center;
        }
        .daily-progress {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.9em;
            color: #666;
        }
        .daily-progress span {
            flex: 1;
            text-align: center;
            padding: 2px;
            border-radius: 3px;
        }
        .daily-progress span.completed {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        .daily-progress span.missed {
            background-color: #ffebee;
            color: #c62828;
        }
    </style>
</head>
<body>
    <h1>Weekly Summary</h1>
    
    <!-- Progress Dashboard -->
    <div class="progress-dashboard">
        <div class="progress-metric">
            <div class="progress-label">
                <span>Live Trading Sessions</span>
                <span id="tradingProgress" class="progress-target" onclick="makeTargetEditable(this, 'tradingTarget')">0/5</span>
            </div>
            <div class="progress-bar-container">
                <div id="tradingBar" class="progress-bar"></div>
            </div>
        </div>
        <div class="progress-metric">
            <div class="progress-label">
                <span>Gym Workouts</span>
                <span id="gymProgress" class="progress-target" onclick="makeTargetEditable(this, 'gymTarget')">0/6</span>
            </div>
            <div class="progress-bar-container">
                <div id="gymBar" class="progress-bar"></div>
            </div>
        </div>
        <div class="progress-metric">
            <div class="progress-label">
                <span>HPA Blocks</span>
                <span id="hpaProgress" class="progress-target" onclick="makeTargetEditable(this, 'hpaTarget')">0/2</span>
            </div>
            <div class="progress-bar-container">
                <div id="hpaBar" class="progress-bar"></div>
            </div>
        </div>
        <div class="progress-metric">
            <div class="progress-label">
                <span>Coding Minutes</span>
                <span id="codingProgress" class="progress-target" onclick="makeTargetEditable(this, 'codingTarget')">0/600</span>
            </div>
            <div class="progress-bar-container">
                <div id="codingBar" class="progress-bar"></div>
            </div>
        </div>
    </div>

    <div class="summary-sections">
        <!-- Trading Summary Table -->
        <div class="summary-section">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Trade Journaling Stats</h2>
            <table id="tradeTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Total Trades</th>
                        <th>Trades Journaled</th>
                        <th>Backtesting Trades</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalTradesSum"></td>
                        <td id="totalJournaledSum"></td>
                        <td id="totalBacktestingSum"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Gym Workouts Summary Table -->
        <div class="summary-section">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Gym Workouts</h2>
            <table id="gymTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th class="gym-header-small">Chest/<br>Shoulders/<br>Biceps/<br>Forearms</th>
                        <th class="gym-header-small">Back/<br>Triceps</th>
                        <th class="gym-header-small">Legs/<br>Abs</th>
                        <th class="gym-header-small">Total<br>Splits</th>
                        <th class="gym-header-small">Cardio<br>(min)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalChest"></td>
                        <td id="totalBack"></td>
                        <td id="totalLegs"></td>
                        <td id="totalSplits"></td>
                        <td id="totalCardio"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Tuning Summary Table -->
        <div class="summary-section summary-section-tuning">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Tuning</h2>
            <table id="tuningTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Minutes (HPA Courses)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalTuning"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Freelancing Summary Table -->
        <div class="summary-section summary-section-tuning">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Freelancing</h2>
            <table id="freelanceTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Minutes (Contracting/Freelancing)</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalFreelance"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Reading Summary Table -->
        <div class="summary-section summary-section-tuning">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Reading</h2>
            <table id="readingTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Pages Read</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalReading"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Screen Time & Entertainment Summary Table -->
        <div class="summary-section summary-section-tuning">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Screen Time & Entertainment</h2>
            <table id="screenTimeTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>IG</th>
                        <th>SC</th>
                        <th>Netflix</th>
                        <th>YT</th>
                        <th>Total</th>
                        <th style="color:#d9534f;">X</th>
                        <th style="color:#d9534f;">M</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalIG"></td>
                        <td id="totalSC"></td>
                        <td id="totalNetflix"></td>
                        <td id="totalYT"></td>
                        <td id="totalScreen"></td>
                        <td id="totalPorn"></td>
                        <td id="totalMasturbated"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Walks Summary Table -->
        <div class="summary-section summary-section-tuning">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Walks</h2>
            <table id="walksTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Count</th>
                        <th>Minutes</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalWalksCount"></td>
                        <td id="totalWalksMinutes"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Car Work Summary Table -->
        <div class="summary-section summary-section-tuning">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Car Work</h2>
            <table id="carTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Count</th>
                        <th>Minutes</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalCarCount"></td>
                        <td id="totalCarMinutes"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Smoking Summary Table -->
        <div class="summary-section summary-section-tuning">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Smoking</h2>
            <table id="smokingTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th style="color:#d9534f;">X</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalSmoking"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        <!-- Journaling Summary Table -->
        <div class="summary-section summary-section-tuning">
            <h2 style="text-align:center; font-size:1.3rem; margin-bottom:18px;">Journaling</h2>
            <table id="journalingTable">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th style="color:#007bff;">Morning</th>
                        <th style="color:#007bff;">Night</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here by JavaScript -->
                </tbody>
                <tfoot>
                    <tr style="font-weight:bold; background:#f8f8f8;">
                        <td>Weekly Total</td>
                        <td id="totalJournalMorning"></td>
                        <td id="totalJournalNight"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    <div style="display: flex; justify-content: center; gap: 20px; margin: 30px auto;">
        <a href="accountability_tracker.html" class="nav-link">Daily Tracker</a>
        <a href="monthly_summary.html" class="nav-link">Monthly Summary</a>
    </div>
    <script>
        // Add long-press handler at the start of the script
        let pressTimer;
        let isLongPress = false;

        document.addEventListener('mousedown', function(e) {
            isLongPress = false;
            pressTimer = setTimeout(function() {
                isLongPress = true;
                if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                    if (confirm('Are you REALLY sure? This will delete ALL your data permanently.')) {
                        localStorage.removeItem('tradeJournalWeek');
                        localStorage.removeItem('gymJournalWeek');
                        localStorage.removeItem('tuningJournalWeek');
                        localStorage.removeItem('freelanceJournalWeek');
                        localStorage.removeItem('readingJournalWeek');
                        localStorage.removeItem('screenTimeJournalWeek');
                        localStorage.removeItem('walksJournalWeek');
                        localStorage.removeItem('carJournalWeek');
                        localStorage.removeItem('smokingJournalWeek');
                        localStorage.removeItem('journalingJournalWeek');
                        localStorage.removeItem('weeklyTargets');
                        alert('All data has been cleared.');
                        location.reload();
                    }
                }
            }, 5000); // 5 seconds
        });

        document.addEventListener('mouseup', function() {
            clearTimeout(pressTimer);
        });

        document.addEventListener('mouseleave', function() {
            clearTimeout(pressTimer);
        });

        // Add touch events for mobile
        document.addEventListener('touchstart', function(e) {
            isLongPress = false;
            pressTimer = setTimeout(function() {
                isLongPress = true;
                if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                    if (confirm('Are you REALLY sure? This will delete ALL your data permanently.')) {
                        localStorage.removeItem('tradeJournalWeek');
                        localStorage.removeItem('gymJournalWeek');
                        localStorage.removeItem('tuningJournalWeek');
                        localStorage.removeItem('freelanceJournalWeek');
                        localStorage.removeItem('readingJournalWeek');
                        localStorage.removeItem('screenTimeJournalWeek');
                        localStorage.removeItem('walksJournalWeek');
                        localStorage.removeItem('carJournalWeek');
                        localStorage.removeItem('smokingJournalWeek');
                        localStorage.removeItem('journalingJournalWeek');
                        localStorage.removeItem('weeklyTargets');
                        alert('All data has been cleared.');
                        location.reload();
                    }
                }
            }, 5000); // 5 seconds
        });

        document.addEventListener('touchend', function() {
            clearTimeout(pressTimer);
        });

        document.addEventListener('touchcancel', function() {
            clearTimeout(pressTimer);
        });

        // Store custom targets in localStorage
        let customTargets = JSON.parse(localStorage.getItem('weeklyTargets') || '{}');
        
        // Function to make target editable
        function makeTargetEditable(element, targetKey) {
            const currentText = element.textContent;
            const [current, target] = currentText.split('/');
            
            const input = document.createElement('input');
            input.type = 'number';
            input.value = target;
            input.min = '0';
            
            input.onblur = function() {
                const newTarget = parseInt(this.value) || 0;
                
                // Get existing targets or use defaults
                const existingTargets = customTargets || {
                    tradingTarget: 5,
                    gymTarget: 6,
                    hpaTarget: 2,
                    codingTarget: 600
                };
                
                // Update only the edited target while preserving others
                customTargets = {
                    ...existingTargets,
                    [targetKey]: newTarget
                };
                
                localStorage.setItem('weeklyTargets', JSON.stringify(customTargets));
                
                // Update the text to show current value and new target
                const currentValue = parseInt(current) || 0;
                element.textContent = `${currentValue}/${newTarget}`;
                
                // Update all progress bars
                updateProgressBars();
            };
            
            input.onkeypress = function(e) {
                if (e.key === 'Enter') {
                    this.blur();
                }
            };
            
            element.textContent = '';
            element.appendChild(input);
            input.focus();
        }
    </script>
    <script>
    function getWeekDates() {
        // Get current date in local time
        const today = new Date();
        
        // Find the most recent Sunday
        const sunday = new Date(today);
        const dayOfWeek = today.getDay(); // 0 is Sunday, 1 is Monday, etc.
        sunday.setDate(today.getDate() - dayOfWeek);
        
        // Set time to midnight in local time
        sunday.setHours(0, 0, 0, 0);
        
        const weekDates = [];
        for (let i = 0; i < 7; i++) {
            const d = new Date(sunday);
            d.setDate(sunday.getDate() + i);
            weekDates.push(d);
        }
        return weekDates;
    }

    // Helper function to format date in YYYY-MM-DD format using local time
    function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    // --- PROGRESS BARS ---
    function renderBar(elementId, value, max) {
        const percent = max > 0 ? Math.min(100, (value / max) * 100) : 0;
        const bar = document.getElementById(elementId);
        bar.style.width = percent + '%';
        bar.style.background = percent >= 100 ? 'linear-gradient(90deg, #28a745, #43e97b)' : 'linear-gradient(90deg, #007bff, #00c6ff)';
    }

        function updateProgressBars() {
            const tradeData = JSON.parse(localStorage.getItem('tradeJournalWeek') || '{}');
            const gymData = JSON.parse(localStorage.getItem('gymJournalWeek') || '{}');
            const tuningData = JSON.parse(localStorage.getItem('tuningJournalWeek') || '{}');
            const freelanceData = JSON.parse(localStorage.getItem('freelanceJournalWeek') || '{}');
            
        // Count trading sessions (days with totalTrades > 0)
        let tradingSessions = 0;
        Object.values(tradeData).forEach(entry => {
            if (parseInt(entry.totalTrades) > 0) tradingSessions++;
        });

        // Count gym workouts (excluding rest days)
        let gymWorkouts = 0;
        Object.values(gymData).forEach(entry => {
            if (Array.isArray(entry.splits) && entry.splits.length > 0 && !entry.restDay) {
                gymWorkouts++;
            }
        });

        let hpaMinutes = 0;
        Object.values(tuningData).forEach(entry => {
            hpaMinutes += parseInt(entry.minutes) || 0;
        });
        let hpaBlocks = Math.floor(hpaMinutes / 90);
        
        let codingMinutes = 0;
        Object.values(freelanceData).forEach(entry => {
            codingMinutes += parseInt(entry.minutes) || 0;
        });

        // Get custom targets from localStorage or use defaults
        const targets = JSON.parse(localStorage.getItem('weeklyTargets') || '{}');
        const tradingTarget = targets.tradingTarget || 5;
        const gymTarget = targets.gymTarget || 6;
        const hpaTarget = targets.hpaTarget || 2;
        const codingTarget = targets.codingTarget || 600;

        document.getElementById('tradingProgress').textContent = `${tradingSessions}/${tradingTarget}`;
        document.getElementById('gymProgress').textContent = `${gymWorkouts}/${gymTarget}`;
        document.getElementById('hpaProgress').textContent = `${hpaBlocks}/${hpaTarget}`;
        document.getElementById('codingProgress').textContent = `${codingMinutes}/${codingTarget}`;

        renderBar('tradingBar', tradingSessions, tradingTarget);
        renderBar('gymBar', gymWorkouts, gymTarget);
        renderBar('hpaBar', hpaBlocks, hpaTarget);
        renderBar('codingBar', codingMinutes, codingTarget);
    }

    // --- TABLES ---
    function makeEditable(cell, storageKey, date, field, splitType = null) {
        const input = document.createElement('input');
        input.type = 'number';
        input.min = '0';
        input.value = cell.textContent.trim();
        input.style.width = '100%';

        input.onblur = function() {
            const value = parseInt(this.value) || 0;
            let data = JSON.parse(localStorage.getItem(storageKey) || '{}');

            if (!data[date]) {
                data[date] = {};
            }

            if (splitType) {
                // Handle gym splits
                if (!data[date].splits) {
                    data[date].splits = [];
                }
                // Remove existing entries of this type
                data[date].splits = data[date].splits.filter(s => s !== splitType);
                // Add new entries
                for (let i = 0; i < value; i++) {
                    data[date].splits.push(splitType);
                }
            } else {
                data[date][field] = value;
            }

            localStorage.setItem(storageKey, JSON.stringify(data));
            cell.textContent = value > 0 ? value : '';
            updateAll();
        };

        input.onkeypress = function(e) {
            if (e.key === 'Enter') {
                this.blur();
            }
        };

        cell.textContent = '';
        cell.appendChild(input);
        input.focus();
    }

    function updateTradeTable() {
        const tradeData = JSON.parse(localStorage.getItem('tradeJournalWeek') || '{}');
        const tradeTbody = document.querySelector('#tradeTable tbody');
        let totalTradesSum = 0, totalJournaledSum = 0, totalBacktestingSum = 0;
        tradeTbody.innerHTML = '';
        getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
            const entry = tradeData[dateStr] || { totalTrades: '', journaledTrades: '', backtestingTrades: '' };
            let rowHtml = '';
            if (entry.noTradingToday) {
                rowHtml = `
                    <td>${dateStr}</td>
                    <td colspan="3" style="color:#d9534f;font-weight:bold;text-align:center;">No Trading Today</td>
                `;
            } else {
                const totalTrades = parseInt(entry.totalTrades) || 0;
                const journaledTrades = parseInt(entry.journaledTrades) || 0;
                const backtestingTrades = parseInt(entry.backtestingTrades) || 0;
                totalTradesSum += totalTrades;
                totalJournaledSum += journaledTrades;
                totalBacktestingSum += backtestingTrades;
                rowHtml = `
                    <td>${dateStr}</td>
                    <td class="editable" onclick="makeEditable(this, 'tradeJournalWeek', '${dateStr}', 'totalTrades')">${totalTrades > 0 ? totalTrades : ''}</td>
                    <td class="editable" onclick="makeEditable(this, 'tradeJournalWeek', '${dateStr}', 'journaledTrades')">${journaledTrades > 0 ? journaledTrades : ''}</td>
                    <td class="editable" onclick="makeEditable(this, 'tradeJournalWeek', '${dateStr}', 'backtestingTrades')">${backtestingTrades > 0 ? backtestingTrades : ''}</td>
                `;
            }
            const row = document.createElement('tr');
            row.innerHTML = rowHtml;
            tradeTbody.appendChild(row);
        });
        document.getElementById('totalTradesSum').textContent = totalTradesSum;
        document.getElementById('totalJournaledSum').textContent = totalJournaledSum;
        document.getElementById('totalBacktestingSum').textContent = totalBacktestingSum;
    }

        function updateGymTable() {
            const gymData = JSON.parse(localStorage.getItem('gymJournalWeek') || '{}');
            const gymTbody = document.querySelector('#gymTable tbody');
        let totalChest = 0, totalBack = 0, totalLegs = 0, totalSplits = 0, totalCardio = 0;
            gymTbody.innerHTML = '';
            getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
                const entry = gymData[dateStr] || { splits: [], cardio: '' };
            let rowHtml = '';
                if (entry.restDay) {
                    rowHtml = `
                        <td>${dateStr}</td>
                        <td colspan="5" style="color:#007bff;font-weight:bold;text-align:center;">Rest Day</td>
                    `;
                } else {
                    let chest = 0, back = 0, legs = 0;
                if (Array.isArray(entry.splits)) {
                    chest = entry.splits.filter(s => s === 'Chest/Shoulders/Biceps/Forearms').length;
                    back = entry.splits.filter(s => s === 'Back/Triceps').length;
                    legs = entry.splits.filter(s => s === 'Legs/Abs').length;
                }
                const splitsCount = chest + back + legs;
                const cardio = parseInt(entry.cardio) || 0;
                totalChest += chest;
                totalBack += back;
                totalLegs += legs;
                totalSplits += splitsCount;
                totalCardio += cardio;
                    rowHtml = `
                    <td>${dateStr}</td>
                    <td class="editable" onclick="makeEditable(this, 'gymJournalWeek', '${dateStr}', 'splits', 'Chest/Shoulders/Biceps/Forearms')">${chest > 0 ? chest : ''}</td>
                    <td class="editable" onclick="makeEditable(this, 'gymJournalWeek', '${dateStr}', 'splits', 'Back/Triceps')">${back > 0 ? back : ''}</td>
                    <td class="editable" onclick="makeEditable(this, 'gymJournalWeek', '${dateStr}', 'splits', 'Legs/Abs')">${legs > 0 ? legs : ''}</td>
                    <td>${splitsCount > 0 ? splitsCount : ''}</td>
                    <td class="editable" onclick="makeEditable(this, 'gymJournalWeek', '${dateStr}', 'cardio')">${cardio > 0 ? cardio : ''}</td>
                `;
                }
                const row = document.createElement('tr');
                row.innerHTML = rowHtml;
                gymTbody.appendChild(row);
            });
            document.getElementById('totalChest').textContent = totalChest;
            document.getElementById('totalBack').textContent = totalBack;
            document.getElementById('totalLegs').textContent = totalLegs;
            document.getElementById('totalSplits').textContent = totalSplits;
            document.getElementById('totalCardio').textContent = totalCardio;
        }
        
    function updateTuningTable() {
        const tuningData = JSON.parse(localStorage.getItem('tuningJournalWeek') || '{}');
        const tuningTbody = document.querySelector('#tuningTable tbody');
        let totalTuning = 0;
        tuningTbody.innerHTML = '';
        getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
            const entry = tuningData[dateStr] || { minutes: '' };
            const minutes = parseInt(entry.minutes) || 0;
            totalTuning += minutes;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dateStr}</td>
                <td class="editable" onclick="makeEditable(this, 'tuningJournalWeek', '${dateStr}', 'minutes')">${minutes > 0 ? minutes : ''}</td>
            `;
            tuningTbody.appendChild(row);
        });
        document.getElementById('totalTuning').textContent = totalTuning;
    }

    function updateFreelanceTable() {
        const freelanceData = JSON.parse(localStorage.getItem('freelanceJournalWeek') || '{}');
        const freelanceTbody = document.querySelector('#freelanceTable tbody');
        let totalFreelance = 0;
        freelanceTbody.innerHTML = '';
        getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
            const entry = freelanceData[dateStr] || { minutes: '' };
            const minutes = parseInt(entry.minutes) || 0;
            totalFreelance += minutes;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dateStr}</td>
                <td class="editable" onclick="makeEditable(this, 'freelanceJournalWeek', '${dateStr}', 'minutes')">${minutes > 0 ? minutes : ''}</td>
            `;
            freelanceTbody.appendChild(row);
        });
        document.getElementById('totalFreelance').textContent = totalFreelance;
    }

    function updateReadingTable() {
        const readingData = JSON.parse(localStorage.getItem('readingJournalWeek') || '{}');
        const readingTbody = document.querySelector('#readingTable tbody');
        let totalReading = 0;
        readingTbody.innerHTML = '';
        getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
            const entry = readingData[dateStr] || { pages: '' };
            const pages = parseInt(entry.pages) || 0;
            totalReading += pages;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dateStr}</td>
                <td class="editable" onclick="makeEditable(this, 'readingJournalWeek', '${dateStr}', 'pages')">${pages > 0 ? pages : ''}</td>
            `;
            readingTbody.appendChild(row);
        });
        document.getElementById('totalReading').textContent = totalReading;
    }

    function updateScreenTimeTable() {
        const screenData = JSON.parse(localStorage.getItem('screenTimeJournalWeek') || '{}');
        const screenTbody = document.querySelector('#screenTimeTable tbody');
        let totalIG = 0, totalSC = 0, totalNetflix = 0, totalYT = 0, totalScreen = 0, totalPorn = 0, totalMasturbated = 0;
        screenTbody.innerHTML = '';
        getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
            const entry = screenData[dateStr] || { ig: '', sc: '', netflix: '', yt: '', porn: false, masturbated: false };
            const ig = parseInt(entry.ig) || 0;
            const sc = parseInt(entry.sc) || 0;
            const nf = parseInt(entry.netflix) || 0;
            const yt = parseInt(entry.yt) || 0;
            const total = ig + sc + nf + yt;
            const porn = entry.porn ? 'X' : '';
            const mast = entry.masturbated ? 'X' : '';
            totalIG += ig;
            totalSC += sc;
            totalNetflix += nf;
            totalYT += yt;
            totalScreen += total;
            if (entry.porn) totalPorn++;
            if (entry.masturbated) totalMasturbated++;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dateStr}</td>
                <td class="editable" onclick="makeEditable(this, 'screenTimeJournalWeek', '${dateStr}', 'ig')">${ig > 0 ? ig : ''}</td>
                <td class="editable" onclick="makeEditable(this, 'screenTimeJournalWeek', '${dateStr}', 'sc')">${sc > 0 ? sc : ''}</td>
                <td class="editable" onclick="makeEditable(this, 'screenTimeJournalWeek', '${dateStr}', 'netflix')">${nf > 0 ? nf : ''}</td>
                <td class="editable" onclick="makeEditable(this, 'screenTimeJournalWeek', '${dateStr}', 'yt')">${yt > 0 ? yt : ''}</td>
                <td>${total > 0 ? total : ''}</td>
                <td class="editable" onclick="toggleBoolean(this, 'screenTimeJournalWeek', '${dateStr}', 'porn')" style="color:#d9534f; font-weight:bold;">${porn}</td>
                <td class="editable" onclick="toggleBoolean(this, 'screenTimeJournalWeek', '${dateStr}', 'masturbated')" style="color:#d9534f; font-weight:bold;">${mast}</td>
            `;
            screenTbody.appendChild(row);
        });
        document.getElementById('totalIG').textContent = totalIG;
        document.getElementById('totalSC').textContent = totalSC;
        document.getElementById('totalNetflix').textContent = totalNetflix;
        document.getElementById('totalYT').textContent = totalYT;
        document.getElementById('totalScreen').textContent = totalScreen;
        document.getElementById('totalPorn').textContent = totalPorn;
        document.getElementById('totalMasturbated').textContent = totalMasturbated;
    }

    function updateWalksTable() {
        const walksData = JSON.parse(localStorage.getItem('walksJournalWeek') || '{}');
        const walksTbody = document.querySelector('#walksTable tbody');
        let totalWalksCount = 0, totalWalksMinutes = 0;
        walksTbody.innerHTML = '';
        getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
            const entry = walksData[dateStr] || { count: '', minutes: '' };
            const count = parseInt(entry.count) || 0;
            const minutes = parseInt(entry.minutes) || 0;
            totalWalksCount += count;
            totalWalksMinutes += minutes;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dateStr}</td>
                <td class="editable" onclick="makeEditable(this, 'walksJournalWeek', '${dateStr}', 'count')">${count > 0 ? count : ''}</td>
                <td class="editable" onclick="makeEditable(this, 'walksJournalWeek', '${dateStr}', 'minutes')">${minutes > 0 ? minutes : ''}</td>
            `;
            walksTbody.appendChild(row);
        });
        document.getElementById('totalWalksCount').textContent = totalWalksCount;
        document.getElementById('totalWalksMinutes').textContent = totalWalksMinutes;
    }

    function updateCarTable() {
        const carData = JSON.parse(localStorage.getItem('carJournalWeek') || '{}');
        const carTbody = document.querySelector('#carTable tbody');
        let totalCarCount = 0, totalCarMinutes = 0;
        carTbody.innerHTML = '';
        getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
            const entry = carData[dateStr] || { count: '', minutes: '' };
            const count = parseInt(entry.count) || 0;
            const minutes = parseInt(entry.minutes) || 0;
            totalCarCount += count;
            totalCarMinutes += minutes;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dateStr}</td>
                <td class="editable" onclick="makeEditable(this, 'carJournalWeek', '${dateStr}', 'count')">${count > 0 ? count : ''}</td>
                <td class="editable" onclick="makeEditable(this, 'carJournalWeek', '${dateStr}', 'minutes')">${minutes > 0 ? minutes : ''}</td>
            `;
            carTbody.appendChild(row);
        });
        document.getElementById('totalCarCount').textContent = totalCarCount;
        document.getElementById('totalCarMinutes').textContent = totalCarMinutes;
    }

    function updateSmokingTable() {
        const smokingData = JSON.parse(localStorage.getItem('smokingJournalWeek') || '{}');
        const smokingTbody = document.querySelector('#smokingTable tbody');
        let totalSmoking = 0;
        smokingTbody.innerHTML = '';
        getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
            const entry = smokingData[dateStr] || { smoked: false };
            const smoked = entry.smoked ? 'X' : '';
            if (entry.smoked) totalSmoking++;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dateStr}</td>
                <td class="editable" onclick="toggleBoolean(this, 'smokingJournalWeek', '${dateStr}', 'smoked')" style="color:#d9534f; font-weight:bold;">${smoked}</td>
            `;
            smokingTbody.appendChild(row);
        });
        document.getElementById('totalSmoking').textContent = totalSmoking;
    }

    function updateJournalingTable() {
        const journalingData = JSON.parse(localStorage.getItem('journalingJournalWeek') || '{}');
        const journalingTbody = document.querySelector('#journalingTable tbody');
        let totalJournalMorning = 0, totalJournalNight = 0;
        journalingTbody.innerHTML = '';
        getWeekDates().forEach(date => {
            const dateStr = formatDate(date);
            const entry = journalingData[dateStr] || { morning: false, night: false };
            const morning = entry.morning ? 'X' : '';
            const night = entry.night ? 'X' : '';
            if (entry.morning) totalJournalMorning++;
            if (entry.night) totalJournalNight++;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${dateStr}</td>
                <td class="editable" onclick="toggleBoolean(this, 'journalingJournalWeek', '${dateStr}', 'morning')" style="color:#007bff; font-weight:bold;">${morning}</td>
                <td class="editable" onclick="toggleBoolean(this, 'journalingJournalWeek', '${dateStr}', 'night')" style="color:#007bff; font-weight:bold;">${night}</td>
            `;
            journalingTbody.appendChild(row);
        });
        document.getElementById('totalJournalMorning').textContent = totalJournalMorning;
        document.getElementById('totalJournalNight').textContent = totalJournalNight;
    }

    function toggleBoolean(cell, storageKey, date, field) {
        let data = JSON.parse(localStorage.getItem(storageKey) || '{}');
        if (!data[date]) {
            data[date] = {};
        }
        data[date][field] = !data[date][field];
        localStorage.setItem(storageKey, JSON.stringify(data));
        cell.textContent = data[date][field] ? 'X' : '';
        updateAll();
    }

    function updateAll() {
        updateProgressBars();
        updateTradeTable();
        updateGymTable();
        updateTuningTable();
        updateFreelanceTable();
        updateReadingTable();
        updateScreenTimeTable();
        updateWalksTable();
        updateCarTable();
        updateSmokingTable();
        updateJournalingTable();
    }

    // Initial update
    updateAll();
    </script>
</body>
</html> 